server {
    listen 80 default_server;
    server_name _;

    location /node-metrics {
        proxy_pass http://localhost:9100/metrics;
    }

    # Templated configurations below this line (generated by templating)
    # This bit is not used in final lab as all apps are served via HAproxy insted. But the template is left here incase nginx is enabled again.
    {% if inventory_hostname in groups['web_servers'] %}
        location / {
			proxy_pass http://localhost:{{ nginx_port }};
			proxy_set_header Host $http_host;
        }
    {% endif %}

    {% if inventory_hostname in groups['prometheus_servers'] %}
        location /prometheus {
            proxy_pass http://localhost:9090;
        }      
    {% endif %}

    {% if inventory_hostname in groups['grafana_servers'] %}
        location /grafana {
            proxy_pass http://localhost:{{ grafana_port }};
            proxy_set_header Host $http_host;
        }      
    {% endif %}


    # On internal machines this is so that it will not show the defualt landing page but return 404.
    {% if inventory_hostname in groups['web_servers'] %}
        location / {
            # Return a 404 (Not Found) or 403 (Forbidden) status code, pick one. If you do nothing (leave blank) it will return 404.
            return 404;
        }
    {% endif %}

}
